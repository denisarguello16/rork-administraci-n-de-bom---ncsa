â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  EJEMPLO DE INTEGRACIÃ“N CON REACT NATIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Este archivo muestra cÃ³mo integrar el Google Apps Script con tu app.


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1. CONFIGURAR EL URL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Crea un archivo: constants/googleSheet.ts

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Reemplaza con tu URL de Google Apps Script
export const GOOGLE_SCRIPT_URL = 'PEGA_TU_URL_AQUI';

// Ejemplo:
// export const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx.../exec';
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2. CREAR SERVICIO DE GOOGLE SHEETS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Crea un archivo: services/googleSheetsService.ts

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import { GOOGLE_SCRIPT_URL } from '@/constants/googleSheet';
import { BOMRecord, BOMFormData } from '@/types/bom';
import { ProductInfo, ProductFormData } from '@/types/product';

export class GoogleSheetsService {
  
  // ============ MÃ‰TODOS PARA BOM RECORDS ============
  
  static async addBOMRecord(record: BOMRecord): Promise<{ success: boolean; message?: string; error?: string }> {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'addBOMRecord',
          record: record
        })
      });
      
      const result = await response.json();
      return result;
    } catch (error) {
      console.error('Error al agregar registro BOM:', error);
      return { success: false, error: 'Error de conexiÃ³n' };
    }
  }
  
  static async updateBOMRecord(id: string, updates: Partial<BOMFormData> & { updatedBy?: string; updatedAt?: string }): Promise<{ success: boolean; message?: string; error?: string }> {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'updateBOMRecord',
          id: id,
          updates: updates
        })
      });
      
      const result = await response.json();
      return result;
    } catch (error) {
      console.error('Error al actualizar registro BOM:', error);
      return { success: false, error: 'Error de conexiÃ³n' };
    }
  }
  
  static async deleteBOMRecord(id: string): Promise<{ success: boolean; message?: string; error?: string }> {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'deleteBOMRecord',
          id: id
        })
      });
      
      const result = await response.json();
      return result;
    } catch (error) {
      console.error('Error al eliminar registro BOM:', error);
      return { success: false, error: 'Error de conexiÃ³n' };
    }
  }
  
  static async getBOMRecords(): Promise<{ success: boolean; data?: BOMRecord[]; error?: string }> {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'getBOMRecords'
        })
      });
      
      const result = await response.json();
      return result;
    } catch (error) {
      console.error('Error al obtener registros BOM:', error);
      return { success: false, error: 'Error de conexiÃ³n' };
    }
  }
  
  // ============ MÃ‰TODOS PARA PRODUCTOS ============
  
  static async addProduct(product: ProductInfo): Promise<{ success: boolean; message?: string; error?: string }> {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'addProduct',
          product: product
        })
      });
      
      const result = await response.json();
      return result;
    } catch (error) {
      console.error('Error al agregar producto:', error);
      return { success: false, error: 'Error de conexiÃ³n' };
    }
  }
  
  static async updateProduct(id: string, updates: Partial<ProductFormData> & { updatedBy?: string; updatedAt?: string }): Promise<{ success: boolean; message?: string; error?: string }> {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'updateProduct',
          id: id,
          updates: updates
        })
      });
      
      const result = await response.json();
      return result;
    } catch (error) {
      console.error('Error al actualizar producto:', error);
      return { success: false, error: 'Error de conexiÃ³n' };
    }
  }
  
  static async deleteProduct(id: string): Promise<{ success: boolean; message?: string; error?: string }> {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'deleteProduct',
          id: id
        })
      });
      
      const result = await response.json();
      return result;
    } catch (error) {
      console.error('Error al eliminar producto:', error);
      return { success: false, error: 'Error de conexiÃ³n' };
    }
  }
  
  static async getProducts(): Promise<{ success: boolean; data?: ProductInfo[]; error?: string }> {
    try {
      const response = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          action: 'getProducts'
        })
      });
      
      const result = await response.json();
      return result;
    } catch (error) {
      console.error('Error al obtener productos:', error);
      return { success: false, error: 'Error de conexiÃ³n' };
    }
  }
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3. EJEMPLO DE USO EN TUS CONTEXTOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Puedes usar el servicio en tus contextos para sincronizar con Google Sheets.

EJEMPLO EN BOMContext.tsx:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import { GoogleSheetsService } from '@/services/googleSheetsService';

// Dentro de tu contexto, cuando agregues un registro:
const addRecordMutation = useMutation({
  mutationFn: async (data: BOMFormData) => {
    const records: BOMRecord[] = recordsQuery.data || [];
    const newRecord: BOMRecord = {
      ...data,
      id: Date.now().toString(),
      createdAt: new Date().toISOString(),
    };
    
    // Guardar en AsyncStorage
    const updated = [...records, newRecord];
    await AsyncStorage.setItem(STORAGE_KEY, JSON.stringify(updated));
    
    // NUEVO: Enviar a Google Sheets
    const result = await GoogleSheetsService.addBOMRecord(newRecord);
    
    if (!result.success) {
      console.error('Error al guardar en Google Sheets:', result.error);
      // Opcional: mostrar alerta al usuario
    } else {
      console.log('âœ… Guardado exitosamente en Google Sheets');
    }
    
    return updated;
  },
  onSuccess: (updated) => {
    queryClient.setQueryData(['bomRecords'], updated);
  }
});
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4. SINCRONIZACIÃ“N INICIAL (OPCIONAL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si quieres cargar datos existentes desde Google Sheets cuando la app inicia:

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// En tu contexto o en un useEffect inicial
useEffect(() => {
  const syncFromGoogleSheets = async () => {
    console.log('ğŸ”„ Sincronizando desde Google Sheets...');
    
    const result = await GoogleSheetsService.getBOMRecords();
    
    if (result.success && result.data) {
      // Guardar en AsyncStorage
      await AsyncStorage.setItem(STORAGE_KEY, JSON.stringify(result.data));
      queryClient.setQueryData(['bomRecords'], result.data);
      console.log('âœ… SincronizaciÃ³n completa:', result.data.length, 'registros');
    } else {
      console.error('âŒ Error al sincronizar:', result.error);
    }
  };
  
  syncFromGoogleSheets();
}, []);
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5. EJEMPLO COMPLETO DE FLUJO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Flujo cuando un usuario crea un registro:

1. Usuario completa el formulario en create-record.tsx
2. Presiona "Guardar"
3. addRecord() se ejecuta en BOMContext
4. El registro se guarda en AsyncStorage (local)
5. El registro se envÃ­a a Google Sheets (remoto)
6. La UI se actualiza con el nuevo registro
7. Mensaje de Ã©xito se muestra al usuario

Si falla Google Sheets:
- El registro aÃºn se guarda localmente
- Se muestra un log de error
- La app sigue funcionando normalmente


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6. PROBAR LA INTEGRACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Para probar:

1. Agrega el URL en constants/googleSheet.ts
2. Crea el servicio en services/googleSheetsService.ts
3. Integra el servicio en tu contexto (BOMContext.tsx)
4. Ejecuta la app y crea un registro
5. Ve a tu Google Sheet y verifica que aparezca el registro


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  7. EJEMPLO DE PRUEBA RÃPIDA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Puedes crear una pantalla de prueba temporal:

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
import { GoogleSheetsService } from '@/services/googleSheetsService';

export default function TestScreen() {
  const testConnection = async () => {
    console.log('ğŸ§ª Probando conexiÃ³n...');
    
    const testRecord: BOMRecord = {
      id: 'test-' + Date.now(),
      codigo_sku: '1-999',
      descripcion_sku: 'REGISTRO DE PRUEBA',
      categoria_insumo: 'Test',
      codigo_insumo: 'TEST-001',
      descripcion_insumo: 'Insumo de prueba',
      cantidad_requerida: 1,
      cantidad_piezas_por_caja: 1,
      consumo_por_caja: 1,
      unidad_medida: 'UND',
      createdBy: 'Test User',
      createdAt: new Date().toISOString()
    };
    
    const result = await GoogleSheetsService.addBOMRecord(testRecord);
    
    if (result.success) {
      Alert.alert('âœ… Ã‰xito', 'ConexiÃ³n exitosa! Revisa tu Google Sheet.');
    } else {
      Alert.alert('âŒ Error', result.error || 'Error desconocido');
    }
  };
  
  return (
    <Button title="Probar ConexiÃ³n" onPress={testConnection} />
  );
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ¨ RESUMEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. âœ… Configura el URL en constants/googleSheet.ts
2. âœ… Crea el servicio en services/googleSheetsService.ts  
3. âœ… Integra en tus contextos (BOMContext, ProductContext)
4. âœ… Prueba creando un registro
5. âœ… Verifica en Google Sheets

Â¡Y listo! Tu app ahora guarda todo en Google Sheets automÃ¡ticamente.
